# RWA-HUB ä»£ç è´¨é‡è§„èŒƒ

## ğŸ“‹ æ€»åˆ™

æœ¬è§„èŒƒåŸºäºAdminæ¨¡å—é‡æ„ç»éªŒåˆ¶å®šï¼Œæ—¨åœ¨é¿å…ä»£ç è´¨é‡é—®é¢˜ï¼Œæå‡é¡¹ç›®å¯ç»´æŠ¤æ€§ã€‚

## ğŸš« ç¦æ­¢äº‹é¡¹

### 1. å·¨å‹æ–‡ä»¶
```
âŒ ç¦æ­¢ï¼šå•ä¸ªæ–‡ä»¶è¶…è¿‡500è¡Œä»£ç 
âœ… æ¨èï¼šæŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ï¼Œæ¯ä¸ªæ–‡ä»¶200è¡Œä»¥å†…
```

### 2. é‡å¤ä»£ç 
```python
# âŒ ç¦æ­¢ï¼šé‡å¤å‡½æ•°å®šä¹‰
def validate_address(addr):  # ç¬¬100è¡Œ
    # å®ç°...

def validate_address(addr):  # ç¬¬300è¡Œ
    # é‡å¤å®ç°...

# âœ… æ¨èï¼šç»Ÿä¸€å®ç°
def validate_address(addr):
    # å•ä¸€å®ç°...
```

### 3. æ··ä¹±å¯¼å…¥
```python
# âŒ ç¦æ­¢ï¼šé‡å¤å’Œæ— åºå¯¼å…¥
from datetime import datetime
import json
from datetime import date
import datetime
from json import dumps

# âœ… æ¨èï¼šç»Ÿä¸€æœ‰åºå¯¼å…¥
from datetime import datetime, date
import json
```

### 4. ç¡¬ç¼–ç 
```python
# âŒ ç¦æ­¢ï¼šç¡¬ç¼–ç é­”æ•°å’Œå­—ç¬¦ä¸²
if status == 4:  # ä»€ä¹ˆæ˜¯4ï¼Ÿ
    
# âœ… æ¨èï¼šä½¿ç”¨å¸¸é‡
ASSET_STATUS_DELETED = 4
if status == ASSET_STATUS_DELETED:
```

## âœ… æ¨èå®è·µ

### 1. æ¨¡å—åŒ–è®¾è®¡

#### ç›®å½•ç»“æ„è§„èŒƒ
```
app/routes/[æ¨¡å—å]/
â”œâ”€â”€ __init__.py          # è“å›¾å®šä¹‰å’Œå¯¼å‡º
â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹
â”œâ”€â”€ views.py            # é¡µé¢è§†å›¾
â”œâ”€â”€ api.py              # APIæ¥å£
â”œâ”€â”€ utils.py            # å·¥å…·å‡½æ•°
â””â”€â”€ decorators.py       # è£…é¥°å™¨
```

#### æ¨¡å—èŒè´£åˆ’åˆ†
```python
# auth.py - åªå¤„ç†è®¤è¯ç›¸å…³
# assets.py - åªå¤„ç†èµ„äº§ç®¡ç†
# users.py - åªå¤„ç†ç”¨æˆ·ç®¡ç†
# é¿å…åŠŸèƒ½æ··æ‚
```

### 2. å‘½åè§„èŒƒ

#### å‡½æ•°å‘½å
```python
# APIå‡½æ•°
def api_get_assets_v2():
    """APIç‰ˆæœ¬å‘½åè§„èŒƒ"""

# é¡µé¢å‡½æ•°  
def assets_management_page():
    """é¡µé¢ç‰ˆæœ¬å‘½åè§„èŒƒ"""

# å·¥å…·å‡½æ•°
def validate_solana_address():
    """åŠŸèƒ½æè¿°æ¸…æ™°"""
```

#### å˜é‡å‘½å
```python
# âœ… æ¸…æ™°çš„å˜é‡å
user_wallet_address = "0x123..."
asset_approval_status = 2
total_assets_count = 100

# âŒ æ¨¡ç³Šçš„å˜é‡å
addr = "0x123..."
status = 2
count = 100
```

### 3. æ³¨é‡Šè§„èŒƒ

#### æ¨¡å—æ³¨é‡Š
```python
"""
èµ„äº§ç®¡ç†æ¨¡å—

ä¸»è¦åŠŸèƒ½ï¼š
- èµ„äº§CRUDæ“ä½œ
- å®¡æ ¸æµç¨‹ç®¡ç†
- æ•°æ®å¯¼å‡ºåŠŸèƒ½

ç‰ˆæœ¬: v2.0
ä½œè€…: å¼€å‘å›¢é˜Ÿ
"""
```

#### å‡½æ•°æ³¨é‡Š
```python
def api_delete_asset_v2(asset_id):
    """
    åˆ é™¤èµ„äº§ï¼ˆè½¯åˆ é™¤ï¼‰
    
    Args:
        asset_id (int): èµ„äº§ID
        
    Returns:
        dict: {"success": bool, "message": str}
        
    Raises:
        404: èµ„äº§ä¸å­˜åœ¨
        500: æœåŠ¡å™¨é”™è¯¯
    """
```

### 4. é”™è¯¯å¤„ç†

#### ç»Ÿä¸€é”™è¯¯å“åº”
```python
def api_function():
    try:
        # ä¸šåŠ¡é€»è¾‘
        return jsonify({'success': True, 'data': result})
    except ValidationError as e:
        return jsonify({'success': False, 'error': str(e)}), 400
    except Exception as e:
        current_app.logger.error(f'æ“ä½œå¤±è´¥: {str(e)}')
        return jsonify({'success': False, 'error': 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'}), 500
```

### 5. æ•°æ®åº“æ“ä½œ

#### äº‹åŠ¡å¤„ç†
```python
def update_asset_status(asset_id, status):
    try:
        asset = Asset.query.get_or_404(asset_id)
        asset.status = status
        db.session.commit()
        return True
    except Exception as e:
        db.session.rollback()
        raise e
```

## ğŸ”§ é‡æ„æŒ‡å—

### é‡æ„è§¦å‘æ¡ä»¶
1. **æ–‡ä»¶è¶…è¿‡300è¡Œ**ï¼šè€ƒè™‘æ‹†åˆ†
2. **å‡½æ•°è¶…è¿‡50è¡Œ**ï¼šè€ƒè™‘æ‹†è§£
3. **é‡å¤ä»£ç è¶…è¿‡3å¤„**ï¼šç«‹å³æŠ½å–
4. **å¯¼å…¥è¶…è¿‡20ä¸ª**ï¼šæ£€æŸ¥æ˜¯å¦åˆç†

### é‡æ„æ­¥éª¤
1. **å¤‡ä»½åŸä»£ç **
2. **åˆ†æåŠŸèƒ½æ¨¡å—**
3. **è®¾è®¡æ–°æ¶æ„**
4. **åˆ†æ­¥å®æ–½**
5. **æµ‹è¯•éªŒè¯**
6. **æ–‡æ¡£æ›´æ–°**

## ğŸ“Š è´¨é‡æ£€æŸ¥æ¸…å•

### ä»£ç å®¡æŸ¥è¦ç‚¹
- [ ] æ–‡ä»¶å¤§å°åˆç†ï¼ˆ<500è¡Œï¼‰
- [ ] æ— é‡å¤ä»£ç å’Œå‡½æ•°
- [ ] å¯¼å…¥è¯­å¥æ•´æ´æœ‰åº
- [ ] å‡½æ•°èŒè´£å•ä¸€æ¸…æ™°
- [ ] å˜é‡å‘½åè§åçŸ¥ä¹‰
- [ ] æ³¨é‡Šå®Œæ•´å‡†ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ€§èƒ½è€ƒè™‘åˆç†

### æäº¤å‰æ£€æŸ¥
```bash
# æ£€æŸ¥æ–‡ä»¶è¡Œæ•°
find . -name "*.py" -exec wc -l {} + | sort -n

# æ£€æŸ¥é‡å¤ä»£ç 
grep -r "def function_name" --include="*.py"

# æ£€æŸ¥å¯¼å…¥é¡ºåº
grep -n "^import\|^from" file.py
```

## ğŸ› ï¸ å·¥å…·æ¨è

### ä»£ç è´¨é‡å·¥å…·
```bash
# ä»£ç æ ¼å¼åŒ–
black .

# å¯¼å…¥æ’åº
isort .

# ä»£ç æ£€æŸ¥
flake8 .
pylint app/

# é‡å¤ä»£ç æ£€æµ‹
vulture .
```

### IDEé…ç½®
```json
// VSCodeè®¾ç½®
{
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "editor.formatOnSave": true
}
```

## ğŸ“ˆ æ€§èƒ½è§„èŒƒ

### æŸ¥è¯¢ä¼˜åŒ–
```python
# âœ… ä½¿ç”¨åˆ†é¡µ
pagination = query.paginate(page=page, per_page=20)

# âœ… é¿å…N+1æŸ¥è¯¢
assets = Asset.query.options(joinedload(Asset.creator)).all()

# âŒ é¿å…å…¨è¡¨æ‰«æ
Asset.query.all()  # å±é™©æ“ä½œ
```

### ç¼“å­˜ç­–ç•¥
```python
from functools import lru_cache

@lru_cache(maxsize=128)
def get_asset_types():
    """ç¼“å­˜ä¸å¸¸å˜åŒ–çš„æ•°æ®"""
    return AssetType.query.all()
```

## ğŸ”„ ç»´æŠ¤æµç¨‹

### æ—¥å¸¸ç»´æŠ¤
1. **æ¯å‘¨ä»£ç å®¡æŸ¥**ï¼šæ£€æŸ¥æ–°å¢ä»£ç è´¨é‡
2. **æ¯æœˆé‡æ„è¯„ä¼°**ï¼šè¯†åˆ«éœ€è¦é‡æ„çš„æ¨¡å—
3. **å­£åº¦æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†æå’Œä¼˜åŒ–æ…¢æŸ¥è¯¢

### ç‰ˆæœ¬ç®¡ç†
```bash
# åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/admin-refactor

# æäº¤è§„èŒƒ
git commit -m "é‡æ„(admin): æ‹†åˆ†èµ„äº§ç®¡ç†æ¨¡å—"

# ä»£ç åˆå¹¶
git merge --no-ff feature/admin-refactor
```

## ğŸ“š å­¦ä¹ èµ„æº

### æ¨èé˜…è¯»
- ã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹
- ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹
- ã€ŠFlask Webå¼€å‘å®æˆ˜ã€‹

### åœ¨çº¿èµ„æº
- [Python PEP 8é£æ ¼æŒ‡å—](https://pep8.org/)
- [Flaskæœ€ä½³å®è·µ](https://flask.palletsprojects.com/patterns/)
- [é‡æ„æŠ€æœ¯æ‰‹å†Œ](https://refactoring.guru/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ¶å®šæ—¶é—´**: 2025-05-24  
**é€‚ç”¨èŒƒå›´**: RWA-HUBé¡¹ç›®å…¨ä½“ä»£ç   
**æ‰§è¡Œçº§åˆ«**: å¼ºåˆ¶ 