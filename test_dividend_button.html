<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†çº¢æŒ‰é’®æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ§ª åˆ†çº¢æŒ‰é’®åŠŸèƒ½æµ‹è¯•</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle"></i> æµ‹è¯•è¯´æ˜</h5>
                            <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•åˆ†çº¢æŒ‰é’®çš„æ˜¾ç¤ºå’ŒåŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</p>
                        </div>
                        
                        <div id="walletStatus" class="alert alert-warning">
                            <h6>é’±åŒ…çŠ¶æ€:</h6>
                            <p id="walletInfo">æœªè¿æ¥</p>
                        </div>
                        
                        <div class="mb-3">
                            <button id="connectWallet" class="btn btn-primary">
                                <i class="fas fa-wallet"></i> æ¨¡æ‹Ÿè¿æ¥é’±åŒ…
                            </button>
                            <button id="toggleAdmin" class="btn btn-warning" disabled>
                                <i class="fas fa-user-shield"></i> åˆ‡æ¢ç®¡ç†å‘˜æƒé™
                            </button>
                        </div>
                        
                        <div id="buttonContainer" class="mb-3">
                            <h6>æŒ‰é’®åŒºåŸŸ:</h6>
                            <div class="btn-group" role="group">
                                <button class="btn btn-secondary">
                                    <i class="fas fa-share"></i> Share
                                </button>
                                <!-- åˆ†çº¢æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                            </div>
                        </div>
                        
                        <div id="testResults" class="mt-4">
                            <h6>æµ‹è¯•ç»“æœ:</h6>
                            <ul id="resultsList" class="list-group">
                                <li class="list-group-item">ç­‰å¾…æµ‹è¯•å¼€å§‹...</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // æ¨¡æ‹Ÿé’±åŒ…çŠ¶æ€
        let walletState = {
            connected: false,
            address: '',
            walletType: '',
            balance: 0,
            isAdmin: false
        };
        
        // æµ‹è¯•ç»“æœ
        let testResults = [];
        
        function addTestResult(message, isSuccess = true) {
            const icon = isSuccess ? 'âœ…' : 'âŒ';
            testResults.push(`${icon} ${message}`);
            updateResultsDisplay();
        }
        
        function updateResultsDisplay() {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            testResults.forEach(result => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = result;
                resultsList.appendChild(li);
            });
        }
        
        function updateWalletDisplay() {
            const walletInfo = document.getElementById('walletInfo');
            const walletStatus = document.getElementById('walletStatus');
            
            if (walletState.connected) {
                walletInfo.innerHTML = `
                    è¿æ¥çŠ¶æ€: ${walletState.connected}<br>
                    åœ°å€: ${walletState.address}<br>
                    é’±åŒ…ç±»å‹: ${walletState.walletType}<br>
                    ä½™é¢: ${walletState.balance} USDC<br>
                    ç®¡ç†å‘˜: ${walletState.isAdmin}
                `;
                walletStatus.className = 'alert alert-success';
                document.getElementById('toggleAdmin').disabled = false;
            } else {
                walletInfo.textContent = 'æœªè¿æ¥';
                walletStatus.className = 'alert alert-warning';
                document.getElementById('toggleAdmin').disabled = true;
            }
        }
        
        // åˆ†çº¢æƒé™æ£€æŸ¥å‡½æ•° (å¤åˆ¶è‡ªå®é™…ä»£ç )
        function checkDividendAccess() {
            addTestResult('å¼€å§‹æ£€æŸ¥åˆ†çº¢æƒé™...');
            
            if (!walletState.connected) {
                addTestResult('é’±åŒ…æœªè¿æ¥ï¼Œä¸æ˜¾ç¤ºåˆ†çº¢æŒ‰é’®', true);
                return;
            }
            
            if (!walletState.isAdmin) {
                addTestResult('ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œä¸æ˜¾ç¤ºåˆ†çº¢æŒ‰é’®', true);
                return;
            }
            
            // åˆ›å»ºåˆ†çº¢æŒ‰é’®
            createDividendButton();
        }
        
        function createDividendButton() {
            addTestResult('ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼Œå¼€å§‹åˆ›å»ºåˆ†çº¢æŒ‰é’®...');
            
            // ç§»é™¤å·²å­˜åœ¨çš„åˆ†çº¢æŒ‰é’®
            const existingBtn = document.getElementById('dividendManagementBtn');
            if (existingBtn) {
                existingBtn.remove();
                addTestResult('ç§»é™¤å·²å­˜åœ¨çš„åˆ†çº¢æŒ‰é’®');
            }
            
            // åˆ›å»ºæ–°çš„åˆ†çº¢æŒ‰é’®
            const buttonContainer = document.querySelector('#buttonContainer .btn-group');
            const dividendBtn = document.createElement('a');
            dividendBtn.id = 'dividendManagementBtn';
            dividendBtn.className = 'btn btn-warning ms-2';
            dividendBtn.innerHTML = '<i class="fas fa-coins"></i> åˆ†çº¢ç®¡ç†';
            
            // è®¾ç½®é“¾æ¥ï¼ˆè¿™é‡Œä½¿ç”¨æµ‹è¯•URLï¼‰
            const testTokenSymbol = 'RH-205447';
            const testAddress = walletState.address || '8cU6PAtRTRgfyJu48qfz2hQP5aMGwooxqrCZtyB6UcYP';
            dividendBtn.href = `/assets/${testTokenSymbol}/dividend?eth_address=${testAddress}`;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶æµ‹è¯•
            dividendBtn.addEventListener('click', function(e) {
                e.preventDefault();
                addTestResult(`åˆ†çº¢æŒ‰é’®ç‚¹å‡»æµ‹è¯•: ç›®æ ‡URL = ${this.href}`);
                addTestResult('å¦‚æœæ˜¯å®é™…ç¯å¢ƒï¼Œåº”è¯¥è·³è½¬åˆ°åˆ†çº¢ç®¡ç†é¡µé¢', true);
            });
            
            buttonContainer.appendChild(dividendBtn);
            addTestResult('âœ… åˆ†çº¢æŒ‰é’®åˆ›å»ºæˆåŠŸï¼');
            addTestResult(`æŒ‰é’®é“¾æ¥: ${dividendBtn.href}`);
        }
        
        // äº‹ä»¶å¤„ç†
        document.getElementById('connectWallet').addEventListener('click', function() {
            if (!walletState.connected) {
                walletState.connected = true;
                walletState.address = '8cU6PAtRTRgfyJu48qfz2hQP5aMGwooxqrCZtyB6UcYP';
                walletState.walletType = 'phantom';
                walletState.balance = 1000;
                walletState.isAdmin = false; // é»˜è®¤ä¸æ˜¯ç®¡ç†å‘˜
                
                this.textContent = 'æ–­å¼€é’±åŒ…';
                addTestResult('é’±åŒ…è¿æ¥æˆåŠŸ');
                updateWalletDisplay();
                checkDividendAccess();
            } else {
                walletState.connected = false;
                walletState.address = '';
                walletState.walletType = '';
                walletState.balance = 0;
                walletState.isAdmin = false;
                
                this.innerHTML = '<i class="fas fa-wallet"></i> æ¨¡æ‹Ÿè¿æ¥é’±åŒ…';
                addTestResult('é’±åŒ…å·²æ–­å¼€');
                updateWalletDisplay();
                
                // ç§»é™¤åˆ†çº¢æŒ‰é’®
                const existingBtn = document.getElementById('dividendManagementBtn');
                if (existingBtn) {
                    existingBtn.remove();
                    addTestResult('ç§»é™¤åˆ†çº¢æŒ‰é’®');
                }
            }
        });
        
        document.getElementById('toggleAdmin').addEventListener('click', function() {
            walletState.isAdmin = !walletState.isAdmin;
            addTestResult(`ç®¡ç†å‘˜æƒé™åˆ‡æ¢ä¸º: ${walletState.isAdmin}`);
            updateWalletDisplay();
            checkDividendAccess();
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆ†çº¢æŒ‰é’®åŠŸèƒ½æµ‹è¯•');
            updateWalletDisplay();
        });
    </script>
</body>
</html> 