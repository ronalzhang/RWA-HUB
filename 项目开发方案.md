# RWA-HUB 项目开发方案

## 一、项目概述

### 1.1 项目背景
RWA-HUB 是一个致力于将实物资产进行数字化和通证化的 Web3 平台。通过区块链技术，将不动产和类不动产转化为数字通证，实现资产的流动性提升和价值管理。

### 1.2 项目目标
- 建立安全、透明的资产数字化平台
- 实现资产的标准化通证发行
- 提供完整的资产管理和交易功能
- 建立可靠的分红和收益分配机制

## 二、功能模块

### 2.1 用户系统
- 钱包连接：支持 MetaMask 等主流钱包
- 身份验证：基于钱包地址的身份认证
- 权限管理：管理员和普通用户权限分离

### 2.2 资产管理
- 资产发布：支持不动产和类不动产的创建
- 资产审核：管理员审核机制
- 资产展示：详细的资产信息页面
- 资产搜索：多维度筛选和搜索

#### 2.2.1 资产创建交互逻辑
1. 基础信息：
   - 资产名称：2-100字符
   - 资产位置：5-200字符
   - 资产描述：10-1000字符

2. 不动产(10)类型：
   - 可输入字段：
     * 建筑面积(m²)：大于0且不超过100万
     * 总价值(U)：大于0且不超过1万亿
     * 预期年收入(U)：大于0且不超过总价值
   - 自动计算：
     * 代币数量 = 面积 × 10000（每平米10000个代币）
     * 代币价格 = 总价值 ÷ 代币数量

3. 类不动产(20)类型：
   - 可输入字段：
     * 总价值(U)：大于0且不超过1万亿
     * 代币数量：自定义数量
     * 预期年收入(U)：大于0且不超过总价值
   - 自动计算：
     * 代币价格 = 总价值 ÷ 代币数量

4. 文件上传要求：
   - 图片上传（必须）：
     * 至少上传1张图片
     * 最多10张图片
     * 支持jpg、png、gif格式
     * 单个文件不超过10MB
   - 文档上传（可选）：
     * 最多5个文档
     * 支持pdf、doc、docx格式
     * 单个文件不超过10MB

5. 资产类型切换交互：
   - 切换时清空所有计算相关的输入值
   - 切换显示对应的输入字段
   - 切换显示对应的文档要求说明
   - 重置计算结果显示

6. 实时计算和验证：
   - 输入值变化时实时计算并显示结果
   - 实时验证输入值的合法性
   - 显示详细的计算过程和结果
   - 代币价格自动计算且只读

7. 表单提交：
   - 保存草稿：
     * 保存当前输入的所有内容
     * 状态标记为草稿
     * 成功后跳转到资产详情页
   - 创建资产：
     * 验证所有必填字段
     * 验证图片上传
     * 验证文档上传（可选）
     * 验证计算结果
     * 提交后等待审核

8. 错误处理：
   - 显示友好的错误提示
   - 表单验证错误提示
   - 文件上传错误处理
   - 网络请求错误处理

9. 权限控制：
   - 必须连接钱包才能创建资产
   - 保存用户的钱包地址作为资产所有者
   - 验证用户的操作权限

10. 多语言支持：
    - 支持中英文切换
    - 错误提示多语言
    - 界面文案国际化

### 2.3 通证系统
#### 2.3.1 通证特性
- 代币类型：
  - 标准：ERC20
  - 单位：整数代币，不可分割
  - 总量：固定发行，不可增发
  - 销毁：支持代币销毁机制
  - **实现方案**：
    - **固定供应量**：在合约部署时，设置代币的总供应量为资产的总面积（例如，100平方米的资产对应1000000个代币）。
    - **不可分割**：将代币的小数位数设置为0，确保每个代币是一个完整的单位，不能分割。
    - **合约安全性**：确保合约中没有增发功能，使用OpenZeppelin等经过审计的库来提高安全性。
    - **合约设计**：`initialSupply` 是代币的总供应量，等于资产的总面积x10000，因为是平方厘米。
    - `decimals()` 函数返回0，表示代币确定不可分割。

- 代币规则：
  - 不动产：10000 token = 1平方米
  - 类不动产：按资产规模确定总量
  - 交易单位：最小1个完整token
  - 权益分配：一币一权

#### 2.3.2 发行机制
- 触发条件：
  - 管理员审核通过
  - 资产信息完整
  - 发布人确认

- 发行流程：
  - 合约部署：自动生成ERC20合约
  - 代币铸造：一次性铸造全部代币
  - 代币发放：直接转入发布人钱包
  - 状态更新：记录合约地址和发行信息

- 代币属性：
  - 符号规则：RH-10YYYY（不动产）/ RH-20YYYY（类不动产）
  - 发行总量：面积×10000（不动产）/ 自定义（类不动产）
  - 代币精度：1个代币单位
  - 支持标准：ERC20

#### 2.3.2 交易机制
- 一级市场：
  - 直接从发布人钱包购买
  - USDC 作为支付媒介
  - 智能合约自动分配
  - 实时价格更新

- 收益分配：
  - 平台手续费：x%（可配置）
  - 发布人收益：(100-x)%
  - 自动分账执行
  - 实时到账确认

- 交易流程：
  1. 买方发起购买请求
  2. 支付 USDC 到智能合约
  3. 合约自动分配 USDC（平台+发布人）
  4. 发布人钱包自动转移资产代币

#### 2.3.3 代币管理
- 发布人权限：
  - 持有初始代币
  - 设置交易价格
  - 查看持有人信息
  - 发起分红操作
  - 执行代币销毁

- 平台职责：
  - 不持有代币
  - 不参与代币托管
  - 提供交易撮合
  - 收取手续费

- 持有人权限：
  - 查看代币余额
  - 接收分红收益
  - 参与投票（预留）
  - 转让代币（二期）
  - 参与治理（二期）

#### 2.3.4 后期规划
- 流动性池（二期/三期）：
  - 发布人质押一定比例代币
  - 确保二级市场流动性
  - 自动做市机制
  - 价格稳定机制

- 回购机制（二期/三期）：
  - 发布人回购通道
  - 市场价格稳定
  - 流动性管理
  - 紧急赎回机制

### 2.4 交易系统
#### 2.4.1 交易功能
- 一级市场：
  - 初始发行交易
  - USDC 支付购买
  - 实时余额检查
  - 交易限额管理

- 二级市场：
  - 挂单交易
  - 价格撮合
  - 交易记录
  - 交易状态追踪

#### 2.4.2 交易流程
1. 购买前检查：
   - 钱包连接状态
   - USDC 余额验证
   - 通证剩余数量
   - 智能合约状态检查

2. 交易执行：
   - USDC 授权检查
   - 智能合约调用
   - 交易确认等待
   - 交易状态更新

3. 交易后处理：
   - 链上交易确认
   - 交易记录存储
   - 余额更新推送
   - 交易统计更新

#### 2.4.3 交易历史
- 数据记录：
  - 通过钱包地址索引
  - 记录交易时间戳
  - 保存交易详情
  - 关联资产信息

- 查询功能：
  - 按钱包地址查询
  - 交易类型筛选
  - 时间范围筛选
  - 资产类型筛选

- 数据展示：
  - 交易列表视图
  - 详细交易信息
  - 交易状态追踪
  - 相关资产链接

#### 2.4.4 安全机制
- 交易限制：
  - 单笔最大限额
  - 智能合约限制
  - 价格波动限制
  - 交易频率控制

- 风险控制：
  - 交易签名验证
  - 链上数据验证
  - 异常交易监控
  - 应急暂停机制

#### 2.4.5 用户体验
- 交易界面：
  - 实时价格显示
  - 交易进度提示
  - 余额实时更新
  - 交易历史查询

- 操作流程：
  - 一键购买
  - 交易确认提示
  - 交易结果反馈
  - 错误友好提示

### 2.5 分红系统
- 分红发起：支持 USDC 分红
- 分红执行：智能合约自动分配
- 分红记录：完整的分红历史
- 收益计算：实时收益统计

### 2.6 数据存储
- 链上数据：资产通证信息
- 链下数据：资产详情和用户信息
- 文件存储：七牛云对象存储
- 数据备份：定期备份机制

### 2.7 积分系统（计划中）

#### 2.7.1 积分获取方式
- **广告观看**：用户通过观看广告获得积分。
- **邀请奖励**：邀请新用户注册并完成首次交易后，双方获得积分。
- **注册奖励**：用户首次注册时获得初始积分。
- **每日签到**：用户每天登录平台可获得签到积分。
- **交易奖励**：用户进行资产交易时，根据交易金额给予积分。
- **活动参与**：参与平台活动或完成特定任务可获得积分。

#### 2.7.2 等级制度

采用数字世界风格的等级制度，激励用户参与：

1. **初级**（1-10级）
2. **中级**（11-20级）
3. **高级**（21-30级）
4. **特级**（31-40级）
5. **超凡**（41-50级）
6. **卓越**（51-60级）
7. **非凡**（61-70级）
8. **极致**（71-80级）
9. **巅峰**（81-90级）
10. **至尊**（91-99级）
11. **终极**（100级）

#### 2.7.3 等级特权
- **初级**：基础功能使用，初始交易折扣。
- **中级**：增加交易折扣，解锁每日签到奖励。
- **高级**：享受更高的交易折扣，参与专属活动。
- **特级**：解锁广告积分翻倍，获得专属客服支持。
- **超凡**：享受更高的交易折扣，优先参与内测。
- **卓越**：解锁更多专属活动，获得定期奖励。
- **非凡**：享受更高的交易折扣，参与平台决策。
- **极致**：解锁更多专属活动，获得专属投资建议。
- **巅峰**：享受最高的交易折扣，参与平台内测。
- **至尊**：获得平台荣誉称号，享受所有特权。
- **终极**：享受最高荣誉和特权，参与平台战略决策。

#### 2.7.4 实现建议
- **积分增长**：每级所需积分逐步增加，形成挑战性和成就感。
- **自动升级**：用户积分达到相应等级的要求后，系统自动升级用户等级。
- **等级展示**：在用户界面中展示当前等级、积分进度和下一级所需积分。
- **等级奖励**：根据用户等级，定期发放奖励积分或其他福利。

## 三、技术架构

### 3.1 前端架构
- 框架：HTML5 + CSS3 + JavaScript
- UI库：Bootstrap 5
- Web3：Web3.js
- 插件：AOS动画、轮播图等
- 国际化：
  - i18next：多语言支持
  - 默认语言：English
  - 可选语言：繁体中文
  - 语言切换组件
  - 本地化存储

### 3.2 后端架构
- 框架：Python Flask
- 数据库：PostgreSQL
- ORM：SQLAlchemy
- 缓存：Redis（计划中）

### 3.3 区块链架构
- 网络：以太坊主网/测试网
- 合约：Solidity智能合约
- 代币：ERC20标准
- 钱包：Web3钱包集成

### 3.4 存储架构
- 文件存储：七牛云对象存储
- 数据库：PostgreSQL
- 缓存：内存缓存
- 日志：本地+远程日志

### 3.5 智能合约配置

1. **获取Infura API密钥**：
   - 访问 [Infura](https://infura.io)
   - 创建一个账户
   - 创建一个新项目
   - 复制项目的API密钥

2. **获取Etherscan API密钥**：
   - 访问 [Etherscan](https://etherscan.io)
   - 创建一个账户
   - 在账户设置中生成API密钥

3. **准备MetaMask钱包**：
   - 安装MetaMask浏览器扩展
   - 创建或导入钱包
   - 切换到Sepolia测试网
   - 从水龙头获取测试ETH（例如：[Sepolia Faucet](https://sepoliafaucet.com/)）
   - 导出私钥

4. **配置环境变量**：
   - 复制 `.env.example` 到 `.env`
   - 填写实际的API密钥和私钥

## 四、开发计划

### 4.1 第一阶段（已完成）
- [x] 基础框架搭建
- [x] 用户系统实现
- [x] 资产管理基础功能
- [x] 前端界面开发

### 4.2 第二阶段（进行中）
- [ ] 通证交易系统
- [ ] 分红系统完善
- [ ] 数据统计功能
- [ ] 智能合约开发
- [ ] 一级市场功能
- [ ] 性能优化

### 4.3 第三阶段（计划中）
- [ ] 二级市场功能
- [ ] 移动端适配
- [ ] 多链支持
- [ ] 社区功能

### 4.4 第四阶段（计划中）
- [ ] 积分系统开发
- [ ] 等级制度实施
- [ ] 用户界面优化
- [ ] 积分获取和使用分析
- [ ] 平台代币集成
- [ ] DAO治理机制

## 五、安全方案

### 5.1 应用安全
- HTTPS 加密
- CSRF 防护
- XSS 防护
- SQL注入防护

### 5.2 智能合约安全
- 合约审计
- 权限控制
- 金额限制
- 紧急暂停

### 5.3 数据安全
- 数据加密
- 访问控制
- 备份恢复
- 日志审计

## 六、运维方案

### 6.1 部署架构
- 使用 Render 云平台
- 自动化部署
- 负载均衡
- 监控告警

### 6.2 性能优化
- 前端缓存
- 数据库优化
- 代码优化
- CDN加速

### 6.3 运维监控
- 服务监控
- 性能监控
- 错误追踪
- 用户分析

## 七、项目管理

### 7.1 版本控制
- Git 版本管理
- 分支管理策略
- 代码审查
- 自动化测试

### 7.2 文档管理
- 技术文档
- API文档
- 用户手册
- 部署文档

### 7.3 进度管理
- 敏捷开发
- 周期迭代
- 任务追踪
- 进度报告

## 服务器管理

### PM2 服务管理

项目使用 PM2 进行服务管理，配置文件为 `ecosystem.config.js`。

#### 常用命令
- 查看服务状态：`pm2 status rwa-hub`
- 重启服务：`pm2 restart rwa-hub`
- 查看日志：`pm2 logs rwa-hub`
- 实时监控：`pm2 monit`

#### 状态说明
- `status`: 服务状态（online/error/stopped）
- `cpu`: CPU 使用率
- `mem`: 内存使用量
- `uptime`: 运行时间
- `↺`: 重启次数

### 代码更新流程

1. 本地开发完成后推送到 GitHub：
```bash
git add .
git commit -m "更新babel.cfg"
git push origin main
```

2. 服务器更新流程：
```bash
# 激活虚拟环境
source .venv/bin/activate

# 拉取最新代码
git pull origin main

# 如果有翻译更新，编译翻译文件
pybabel compile -d app/translations

# 重启服务
pm2 restart rwa-hub
```

### 注意事项

1. 服务内存使用说明：
   - 初始启动：约 7MB
   - 正常运行：50-80MB
   - 内存会随服务运行逐渐增长，这是正常现象

2. 日志查看：
   - PM2 日志：`pm2 logs rwa-hub`
   - 应用日志：`tail -f logs/app.log`

3. 环境变量：
   - 生产环境配置在 `ecosystem.config.js` 中
   - 本地开发使用 `.env` 文件 